<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>stopwatch</title>
  <style>
    :root{
      /* palette (sky + white + gray only) */
      --bg: #D4E4F2;            /* very light sky */
      --card: #BAD1E6;          /* soft sky */
      --btn: rgba(255,255,255,0.30);
      --btn-hover: rgba(255,255,255,0.38);

      --strong: rgba(255,255,255,0.55);   /* emphasized button */
      --strong-hover: rgba(255,255,255,0.65);

      --pause: rgba(255,255,255,0.22);    /* pause tone (still sky/white/gray) */
      --pause-hover: rgba(255,255,255,0.30);

      --text: rgba(255,255,255,0.96);     /* main screen text: no black */
      --shadow-soft: rgba(0,0,0,0.10);
      --shadow-strong: rgba(0,0,0,0.16);
    }

    html,body{
      height:100%;
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: transparent;
    }
    body{
      display:flex;
      align-items:center;
      justify-content:center;
    }

    .card{
      width: 300px;
      background: var(--card);
      border-radius: 18px;
      box-shadow: 0 14px 30px var(--shadow-soft);
      padding: 16px;
      box-sizing: border-box;
    }

    /* dropdown */
    select{
      width:100%;
      border:none;
      border-radius: 999px;
      padding: 10px 12px;
      font-size: 14px;
      outline: none;
      background: rgba(255,255,255,0.55);
      color: #2f4f63; /* dropdown opened text can be dark: ok */
      box-shadow: 0 8px 18px var(--shadow-soft);
    }

    .timer{
      margin: 16px 0 14px;
      text-align:center;
      font-weight: 900;
      letter-spacing: 2px;
      font-size: 56px;
      color: var(--text);
      text-shadow: 0 8px 18px var(--shadow-strong);
      user-select:none;
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-top: 6px;
    }
    .rowSingle{ margin-top: 12px; }

    button{
      border:none;
      border-radius: 999px; /* pill */
      padding: 12px 12px;
      font-size: 14px;
      font-weight: 850;
      letter-spacing: .2px;
      color: var(--text);
      background: var(--btn);
      cursor:pointer;
      box-shadow: 0 10px 22px var(--shadow-soft);
      transition: transform 0.14s ease, box-shadow 0.14s ease, background 0.14s ease, opacity 0.14s ease;
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
    }
    button:hover{
      background: var(--btn-hover);
      box-shadow: 0 12px 26px var(--shadow-strong);
      transform: translateY(-1px);
    }
    button:active{
      transform: translateY(0px);
      box-shadow: 0 8px 18px var(--shadow-soft);
    }
    button:disabled{
      opacity:.45;
      cursor:not-allowed;
      transform: none;
    }

    /* emphasis states */
    button.primary{
      background: var(--strong);
      box-shadow: 0 12px 26px var(--shadow-strong);
    }
    button.primary:hover{ background: var(--strong-hover); }

    button.pauseTone{
      background: var(--pause);
    }
    button.pauseTone:hover{ background: var(--pause-hover); }

    button.ghost{
      opacity:.55;
    }

    .status{
      margin-top: 12px;
      font-size: 12px;
      color: rgba(255,255,255,0.85);
      min-height: 16px;
      text-align:center;
      user-select:none;
    }
  </style>
</head>
<body>
  <div class="card">
    <select id="subject">
      <option value="아침 영단어">아침 영단어</option>
      <option value="영어">영어</option>
      <option value="국어">국어</option>
      <option value="한국사">한국사</option>
      <option value="행정법">행정법</option>
      <option value="행정학">행정학</option>
      <option value="저녁 영단어">저녁 영단어</option>
    </select>

    <div class="timer" id="timer">00:00</div>

    <div class="grid">
      <button id="start">start</button>
      <button id="clear">clear</button>
    </div>

    <div class="rowSingle">
      <button id="pause" style="width:100%;" disabled>pause</button>
    </div>

    <div class="status" id="status"></div>
  </div>

<script>
(() => {
  const elTimer = document.getElementById("timer");
  const elStatus = document.getElementById("status");
  const elSubject = document.getElementById("subject");

  const btnStart = document.getElementById("start");
  const btnClear = document.getElementById("clear");
  const btnPause = document.getElementById("pause");

  let running = false;
  let paused = false;
  let startMs = 0;
  let elapsedMs = 0;
  let tickId = null;

  function fmt(ms){
    const totalSec = Math.floor(ms / 1000);
    const mm = String(Math.floor(totalSec / 60)).padStart(2,"0");
    const ss = String(totalSec % 60).padStart(2,"0");
    return `${mm}:${ss}`;
  }

  function setStatus(text){
    elStatus.textContent = text || "";
  }

  function nowMs(){
    return elapsedMs + (running && !paused ? (Date.now() - startMs) : 0);
  }

  function syncUI(){
    // reset classes
    btnStart.classList.remove("primary","ghost");
    btnClear.classList.remove("primary","ghost");
    btnPause.classList.remove("pauseTone","ghost","primary");

    const timeMs = nowMs();
    const hasAnyTime = timeMs >= 1000; // >= 1s

    if (!running) {
      // idle: start emphasized, clear muted (and disabled at 00:00)
      btnStart.disabled = false;
      btnStart.classList.add("primary");

      btnPause.disabled = true;
      btnPause.textContent = "pause";

      btnClear.disabled = !hasAnyTime;
      btnClear.classList.add("ghost");
    } else {
      // running/paused: clear emphasized, start muted/disabled, pause in its own tone
      btnStart.disabled = true;
      btnStart.classList.add("ghost");

      btnClear.disabled = false;
      btnClear.classList.add("primary");

      btnPause.disabled = false;
      btnPause.classList.add("pauseTone");
      btnPause.textContent = paused ? "resume" : "pause";
    }
  }

  function render(){
    elTimer.textContent = fmt(nowMs());
    syncUI();
  }

  function stopTick(){
    if (tickId) clearInterval(tickId);
    tickId = null;
  }

  function start(){
    if (running) return;
    running = true;
    paused = false;
    elapsedMs = 0;
    startMs = Date.now();
    setStatus("");

    stopTick();
    tickId = setInterval(render, 200);
    render();
  }

  function togglePause(){
    if (!running) return;

    if (!paused){
      elapsedMs += Date.now() - startMs;
      paused = true;
    } else {
      startMs = Date.now();
      paused = false;
    }
    render();
  }

  async function clearAndSave(){
    // if not running: just reset UI (no save)
    if (!running) {
      elapsedMs = 0;
      paused = false;
      running = false;
      stopTick();
      setStatus("");
      render();
      return;
    }

    // freeze time
    if (!paused) elapsedMs += Date.now() - startMs;

    const minutes = Math.floor((elapsedMs / 1000) / 60);
    const subject = elSubject.value;

    // lock ui during save
    btnStart.disabled = true;
    btnClear.disabled = true;
    btnPause.disabled = true;

    try{
      const r = await fetch("/api/save", {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({ subject, minutes })
      });

      const j = await r.json().catch(() => ({}));

      if (!r.ok || !j.ok){
        setStatus("error");
      } else {
        setStatus("saved");
      }
    } catch(e){
      setStatus("error");
    } finally {
      // reset timer and stop
      running = false;
      paused = false;
      elapsedMs = 0;
      stopTick();
      render(); // syncUI happens inside

      // re-enable after render decided states
      // (syncUI will enable start, disable clear if 00:00)
    }
  }

  btnStart.addEventListener("click", start);
  btnPause.addEventListener("click", togglePause);
  btnClear.addEventListener("click", clearAndSave);

  render();
})();
</script>
</body>
</html>
