<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>stopwatch ui v4</title>
  <style>
    :root{
      /* palette */
      --c-light: #D4E4F2;  /* light sky */
      --c-deep:  #BAD1E6;  /* deeper sky */
      --resume:  #98a0ab;  /* resume button */

      /* surfaces */
      --card: var(--c-light);
      --btn-base: var(--c-deep);
      --btn-hover: #aecde3;

      --btn-strong: #9fc3df;       /* emphasized (start/pause/clear) */
      --btn-strong-hover: #8fb9d7;

      /* text */
      --text: rgba(255,255,255,0.96);
      --text-soft: rgba(255,255,255,0.82);

      /* shadows */
      --shadow-soft: rgba(0,0,0,0.10);
      --shadow-strong: rgba(0,0,0,0.18);
    }

    html,body{
      height:100%;
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: transparent; /* important for notion embed */
    }
    body{
      display:flex;
      align-items:center;
      justify-content:center;
    }

    .card{
      width: 300px;
      background: var(--card);
      border-radius: 18px;
      box-shadow: 0 14px 30px var(--shadow-soft);
      padding: 16px;
      box-sizing: border-box;
      position: relative;
    }

    /* dropdown (dark text allowed here) */
    select{
      width:100%;
      border:none;
      border-radius: 999px;
      padding: 10px 12px;
      font-size: 14px;
      outline: none;
      background: rgba(255,255,255,0.70);
      color: #2f4f63;
      box-shadow: 0 8px 18px var(--shadow-soft);
    }

    .timer{
      margin: 16px 0 14px;
      text-align:center;
      font-weight: 900;
      letter-spacing: 2px;
      font-size: 56px;
      color: var(--text);
      text-shadow: 0 9px 20px var(--shadow-strong);
      user-select:none;
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-top: 6px;
    }
    .rowSingle{ margin-top: 12px; }

    button{
      border:none;
      border-radius: 999px; /* pill */
      padding: 12px 12px;
      font-size: 14px;
      font-weight: 850;
      letter-spacing: .2px;
      color: var(--text);
      background: var(--btn-base);
      cursor:pointer;
      box-shadow: 0 10px 22px var(--shadow-soft);
      transition: transform 0.14s ease, box-shadow 0.14s ease, background 0.14s ease, opacity 0.14s ease;
    }
    button:hover{
      background: var(--btn-hover);
      box-shadow: 0 12px 26px var(--shadow-strong);
      transform: translateY(-1px);
    }
    button:active{
      transform: translateY(0px);
      box-shadow: 0 8px 18px var(--shadow-soft);
    }
    button:disabled{
      opacity:.45;
      cursor:not-allowed;
      transform: none;
    }

    button.primary{
      background: var(--btn-strong);
      box-shadow: 0 12px 26px var(--shadow-strong);
    }
    button.primary:hover{ background: var(--btn-strong-hover); }

    button.ghost{ opacity:.55; }

    button.resumeDark{
      background: var(--resume) !important;
      box-shadow: 0 12px 26px var(--shadow-strong);
    }
    button.resumeDark:hover{
      filter: brightness(0.96);
    }

    .status{
      margin-top: 12px;
      font-size: 12px;
      color: var(--text-soft);
      min-height: 16px;
      text-align:center;
      user-select:none;
    }

    /* tiny version mark to confirm deploy */
    .mark{
      position:absolute;
      right:10px;
      bottom:10px;
      font-size:10px;
      color: rgba(255,255,255,0.65);
      user-select:none;
    }
  </style>
</head>
<body>
  <div class="card">
    <select id="subject">
      <option value="아침 영단어">아침 영단어</option>
      <option value="영어">영어</option>
      <option value="국어">국어</option>
      <option value="한국사">한국사</option>
      <option value="행정법">행정법</option>
      <option value="행정학">행정학</option>
      <option value="저녁 영단어">저녁 영단어</option>
    </select>

    <div class="timer" id="timer">00:00</div>

    <div class="grid">
      <button id="start">start</button>
      <button id="clear">clear</button>
    </div>

    <div class="rowSingle">
      <button id="pause" style="width:100%;">pause</button>
    </div>

    <div class="status" id="status"></div>
    <div class="mark">ui v4</div>
  </div>

<script>
(() => {
  const elTimer = document.getElementById("timer");
  const elStatus = document.getElementById("status");
  const elSubject = document.getElementById("subject");

  const btnStart = document.getElementById("start");
  const btnClear = document.getElementById("clear");
  const btnPause = document.getElementById("pause");

  let running = false;
  let paused = false;
  let startMs = 0;
  let elapsedMs = 0;
  let tickId = null;

  function fmt(ms){
    const totalSec = Math.floor(ms / 1000);
    const mm = String(Math.floor(totalSec / 60)).padStart(2,"0");
    const ss = String(totalSec % 60).padStart(2,"0");
    return `${mm}:${ss}`;
  }

  function setStatus(text){
    elStatus.textContent = text || "";
  }

  function nowMs(){
    return elapsedMs + (running && !paused ? (Date.now() - startMs) : 0);
  }

  function stopTick(){
    if (tickId) clearInterval(tickId);
    tickId = null;
  }

  function syncUI(){
    // reset classes + resume styling
    btnStart.className = "";
    btnClear.className = "";
    btnPause.className = "";

    // keep ids intact (className reset is ok)
    const timeMs = nowMs();
    const hasAnyTime = timeMs >= 1000;

    if (!running) {
      // idle 00:00: start + pause emphasized
      btnStart.disabled = false;
      btnStart.classList.add("primary");

      btnPause.disabled = false;
      btnPause.textContent = "pause";
      btnPause.classList.add("primary");

      btnClear.disabled = !hasAnyTime;
      btnClear.classList.add("ghost");
      return;
    }

    // running or paused:
    btnStart.disabled = true;
    btnStart.classList.add("ghost");

    btnClear.disabled = false;
    btnClear.classList.add("primary");

    btnPause.disabled = false;

    if (paused) {
      btnPause.textContent = "resume";
      btnPause.classList.add("resumeDark");
    } else {
      btnPause.textContent = "pause";
      btnPause.classList.add("primary");
    }
  }

  function render(){
    elTimer.textContent = fmt(nowMs());
    syncUI();
  }

  function start(){
    if (running) return;
    running = true;
    paused = false;
    elapsedMs = 0;
    startMs = Date.now();
    setStatus("");

    stopTick();
    tickId = setInterval(render, 200);
    render();
  }

  function togglePause(){
    if (!running) {
      // idle 상태에서도 pause를 누를 수 있게 해달라고 했지만,
      // 실제 동작은 "아무것도 안 함"이 자연스럽다 (UI만 강조되어 있음)
      return;
    }

    if (!paused){
      elapsedMs += Date.now() - startMs;
      paused = true;
    } else {
      startMs = Date.now();
      paused = false;
    }
    render();
  }

  async function clearAndSave(){
    // idle에서는 그냥 리셋만
    if (!running) {
      elapsedMs = 0;
      paused = false;
      running = false;
      stopTick();
      setStatus("");
      render();
      return;
    }

    // freeze time
    if (!paused) elapsedMs += Date.now() - startMs;

    const minutes = Math.floor((elapsedMs / 1000) / 60);
    const subject = elSubject.value;

    // lock UI during save
    btnStart.disabled = true;
    btnClear.disabled = true;
    btnPause.disabled = true;

    try{
      const r = await fetch("/api/save", {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({ subject, minutes })
      });
      const j = await r.json().catch(() => ({}));

      if (!r.ok || !j.ok){
        setStatus("error");
      } else {
        setStatus("saved");
      }
    } catch(e){
      setStatus("error");
    } finally {
      // reset timer and stop
      running = false;
      paused = false;
      elapsedMs = 0;
      stopTick();
      render();
    }
  }

  btnStart.addEventListener("click", start);
  btnPause.addEventListener("click", togglePause);
  btnClear.addEventListener("click", clearAndSave);

  render();
})();
</script>
</body>
</html>
